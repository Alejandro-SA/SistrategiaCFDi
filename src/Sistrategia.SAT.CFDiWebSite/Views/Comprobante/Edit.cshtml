@using Sistrategia.SAT.CFDiWebSite.Models
@model ComprobanteEditViewModel
@{
    ViewBag.Title = "Editar un comprobante";
}

@using (Html.BeginForm("Edit", "Comprobante", FormMethod.Post, new { @class = "form-horizontal", role = "form" })) {
  @Html.AntiForgeryToken()
  @Html.HiddenFor(m => m.ComprobanteId)

<div class="col-md-12">
    <h1 class="text-center">Editar un comprobante</h1>
    <br />
</div>
<div class="col-md-12">
    <div class='text-center' id="danger"></div>
</div>
<div class="col-md-12">
    <div id="initial_model_id">
        <div class="form-horizontal">
            <div class="form-group">
                @Html.LabelFor(m => m.Serie, new { @class = "col-md-1 control-label" })
                <div class="col-md-1">
                    @*<input class="form-control" type="text" data-bind="value: Serie" />*@
                  @Html.TextBoxFor(m => m.Serie, new { @class = "form-control" })
                </div>
                @Html.LabelFor(m => m.Folio, new { @class = "col-md-1  control-label" })
                <div class="col-md-1">
                    @*<input class="form-control" type="text" data-bind="value: Folio" />*@
                  @Html.TextBoxFor(m => m.Folio, new { @class = "form-control" })
                </div>
              @Html.LabelFor(m => m.Fecha, new { @class = "col-md-1  control-label" })
              <div class="col-md-2">               
                @Html.TextBoxFor(m => m.Fecha, new { @class = "form-control" })
              </div>
                @*@Html.LabelFor(m => m.Moneda, new { @class = "col-md-2 control-label" })
                <div class="col-md-2">
                    @Html.DropDownListFor(m => m.Moneda, Model.TiposMoneda, "Seleccione", new { @class = "form-control", data_bind = "value: Moneda" })
                </div>
                @Html.LabelFor(m => m.TipoCambio, new { @class = "col-md-2 control-label" })
                <div class="col-md-2">
                    <input class="form-control" type="number" data-bind="value: TipoCambio" />
                </div>*@
            </div>
        </div>
        @*<br />
        <div class="form-horizontal">
            <div class="form-group">
                @Html.LabelFor(m => m.Emisor, new { @class = "col-md-1  control-label" })
                <div class="col-md-5">
                    <select class="form-control" data-bind="value: EmisorId" id="EmisorId"></select>
                </div>
                @Html.LabelFor(m => m.Receptor, new { @class = "col-md-1  control-label" })
                <div class="col-md-5">
                    <select class="form-control" data-bind="value: ReceptorId" id="ReceptorId"></select>
                </div>
            </div>
        </div>*@
        @*<div class="form-horizontal">
            <div class="form-group">
                @Html.LabelFor(m => m.LugarExpedicion, new { @class = "col-md-2 control-label" })
                <div class="col-md-4">
                    <input class="form-control" type="text" data-bind="value: LugarExpedicion" />
                </div>
                @Html.LabelFor(m => m.Certificados, new { @class = "col-md-1  control-label" })
                <div class="col-md-5">
                    <select class="form-control" data-bind="value: CertificadoId" id="CertificadoId"></select>
                </div>
            </div>
        </div>*@
        @*<div class="form-horizontal">
            <div class="form-group">
                @Html.LabelFor(m => m.FormaDePago, new { @class = "col-md-1  control-label" })
                <div class="col-md-5">
                    @Html.DropDownListFor(m => m.FormaDePago, Model.TiposFormaDePago, "Seleccione", new { @class = "form-control", data_bind = "value: FormaDePago" })
                </div>
                @Html.LabelFor(m => m.MetodoDePago, new { @class = "col-md-2  control-label" })
                <div class="col-md-4">
                    @Html.DropDownListFor(m => m.MetodoDePago, Model.TipoMetodoDePago, "Seleccione", new { @class = "form-control", data_bind = "value: MetodoDePago" })
                </div>      
            </div>
        </div>*@
    </div>
    @*<div id="conceptos_model_id">
        <div class="col-md-12">
            <h2 class="text-center">Conceptos</h2>
            <br />
        </div>
        <div class="col-md-1">
            <input type="number" class="form-control" data-bind="value: Cantidad" placeholder="Cantidad">
        </div>
        <div class="col-md-1">
            <input type="text" class="form-control" data-bind="value: Unidad" placeholder="Unidad">
        </div>
        <div class="col-md-1">
            <input type="text" class="form-control" data-bind="value: NoIdentificacion" placeholder="Identificación">
        </div>
        <div class="col-md-5">
            <input type="text" class="form-control" data-bind="value: Descripcion" placeholder="Descripción">
        </div>
        <div class="col-md-2">
            <input type="number" class="form-control" data-bind="value: ValorUnitario" placeholder="Precio">
        </div>
        <div class="col-md-2">
            <button type="button" class="btn btn-default form-control" data-bind="enable: (Cantidad().length > 0 && Unidad().length > 0 && NoIdentificacion().length > 0 && Descripcion().length > 0 && ValorUnitario().length > 0), click: addItem">Agregar</button>
        </div>
        <div class="col-md-12"><br /></div>
        <div class="col-md-12" data-bind="visible: HasItems()">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th class="text-center">N°</th>
                        <th class="text-center">Cantidad</th>
                        <th class="text-center">Unidad</th>
                        <th class="text-center">Identificación</th>
                        <th class="text-center">Descripción</th>
                        <th class="text-center">Precio</th>
                        <th class="text-center">Importe</th>
                        <th class="text-center">Acciones</th>
                    </tr>
                </thead>
                <tbody data-bind='foreach: Items'>
                    <tr>
                        <td data-bind='text: ConceptoOrdinal' class="text-center"></td>
                        <td data-bind='text: ConceptoCantidad' class="text-center"></td>
                        <td data-bind='text: ConceptoUnidad' class="text-center"></td>
                        <td data-bind='text: ConceptoNoIdentificacion' class="text-center"></td>
                        <td data-bind='text: ConceptoDescripcion' class="text-center"></td>
                        <td data-bind='text: ConceptoValorUnitario' class="text-center"></td>
                        <td data-bind='text: ConceptoImporte' class="text-center"></td>
                        <td class="text-center">
                            <a href="#" class="btn btn-danger btn-sm" data-bind="click: $root.removeSelected">
                                <span class="glyphicon glyphicon-trash"></span>
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>*@
    <div class="col-md-12">

  <div class="form-horizontal">
    <div class="form-group">

      @Html.LabelFor(m => m.Notas, new { @class = "col-md-1  control-label" })
      <div class="col-md-7">
        @*<textarea class="form-control" data-bind="value: Nota"></textarea>*@
        @Html.TextAreaFor(m => m.Notas, new { @class = "col-md-8 form-control" })
      </div>
      </div>
    </div>

      <hr />
    </div>
    <div id="impuestos_model_id">
      <div class="col-md-8">

        <h4>Cadena Original:</h4>
        <p><small>@Model.CadenaOriginal</small></p>
        <h4>Sello:</h4>
        <p><small>@Model.Sello</small></p>
        <h4>Sello calculado:</h4>
        <p><small>@Model.GetSello</small></p>



        @*<div class="col-md-12">
              <h3 class="text-center" style="margin-top: 0;">Impuestos trasladados</h3>
              <br />
          </div>*@
        @*<div class="col-md-3">
              @Html.DropDownList("TiposImpuestoTraslado", Model.TiposImpuestoTraslado, "Seleccione", new { @class = "form-control", data_bind = "value: TrasladosImpuesto" })
          </div>
          <div class="col-md-3">
              <input type="text" class="form-control" data-bind="value: TrasladosTasa" placeholder="Tasa">
          </div>
          <div class="col-md-3">
              <input type="number" class="form-control" data-bind="value: TrasladosImporte" placeholder="Importe">
          </div>
          <div class="col-md-2">
              <button type="button" class="btn btn-default form-control" data-bind="enable: (TrasladosImpuesto().length > 0 && TrasladosImporte().length > 0 && TrasladosTasa().length > 0), click: addTraslado">Agregar</button>
          </div>
          <div class="col-md-12"><br /></div>*@
        @*<div class="col-md-12" data-bind="visible: TrasladosHasItems()">
              <table class="table table-striped">
                  <thead>
                      <tr>
                          <th class="text-center">N°</th>
                          <th class="text-center">Impuesto</th>
                          <th class="text-center">Tasa</th>
                          <th class="text-center">Importe</th>
                          <th class="text-center">Acciones</th>
                      </tr>
                  </thead>
                  <tbody data-bind="foreach: TrasladosItems">
                      <tr>
                          <td data-bind='text: TrasladadoOrdinal' class="text-center"></td>
                          <td data-bind='text: TrasladadoImpuesto' class="text-center"></td>
                          <td data-bind='text: TrasladadoTasa' class="text-center"></td>
                          <td data-bind='text: TrasladadoImporte' class="text-center"></td>
                          <td class="text-center">
                              <a href="#" class="btn btn-danger btn-sm" data-bind="click: $root.removeTraslado">
                                  <span class="glyphicon glyphicon-trash"></span>
                              </a>
                          </td>
                      </tr>
                  </tbody>
              </table>
          </div>*@
        @*<div class="col-md-12">
              <h3 class="text-center" style="margin-top: 0;">Impuestos retenidos</h3>
              <br />
          </div>*@
        @*<div class="col-md-3">
              @Html.DropDownList("TiposImpuestoRetencion", Model.TiposImpuestoRetencion, "Seleccione", new { @class = "form-control", data_bind = "value: RetencionesImpuesto" })
          </div>
          <div class="col-md-3">
              <input type="number" class="form-control" data-bind="value: RetencionesImporte" placeholder="Importe">
          </div>
          <div class="col-md-2">
              <button type="button" class="btn btn-default form-control" data-bind="enable: (RetencionesImpuesto().length > 0 && RetencionesImporte().length > 0), click: addRetencion">Agregar</button>
          </div>
          <div class="col-md-12"><br /></div>*@
        @*<div class="col-md-12" data-bind="visible: RetencionesHasItems()">
              <table class="table table-striped">
                  <thead>
                      <tr>
                          <th class="text-center">Impuesto</th>
                          <th class="text-center">Importe</th>
                          <th class="text-center">Acciones</th>
                      </tr>
                  </thead>
                  <tbody data-bind="foreach: RetencionesItems">
                      <tr>
                          <td data-bind='text: RetencionOrdinal' class="text-center"></td>
                          <td data-bind='text: RetencionImpuesto' class="text-center"></td>
                          <td data-bind='text: RetencionImporte' class="text-center"></td>
                          <td class="text-center">
                              <a href="#" class="btn btn-danger btn-sm" data-bind="click: $root.removeRetencion">
                                  <span class="glyphicon glyphicon-trash"></span>
                              </a>
                          </td>
                      </tr>
                  </tbody>
              </table>
          </div>*@
      </div>
      <div class="col-md-4">
        <div class="col-md-7" style="font-weight:600">
          Subtotal:
        </div>
        <div class="col-md-5">
          <input class="form-control" data-bind="value: SubTotal" type="number" />
          <br />
        </div>

        <div class="col-md-7" style="font-weight:600">
          Total de impuestos trasladados:
        </div>
        <div class="col-md-5">
          <input class="form-control" data-bind="value: TotalTraslados" type="number" />
          <br />
        </div>

        <div class="col-md-7" style="font-weight:600">
          Total de impuestos retenidos:
        </div>
        <div class="col-md-5" style="font-weight:600">
          <input class="form-control" data-bind="value: TotalRetenciones" type="number" />
          <br />
        </div>
        <div class="col-md-7" style="font-weight:600">
          Total:
        </div>
        <div class="col-md-5">
          <input class="form-control" data-bind="value: Total" type="number" />
          <br />
        </div>
      </div>
    </div>
    <div class="col-md-12">
      <hr />
    </div>
    <div class="form-group">
      <div class="col-md-offset-9 col-md-12">
        <input type="submit" class="btn btn-lg btn-primary" id="enviar_datos" value="@LocalizedStrings.SaveButton" />
      </div>
    </div>
    <div class="col-md-12">
      <hr />
    </div>
  </div>


  <div id="alerta" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <div class="progress progress-striped active" style="margin-bottom: 0;">
            <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">Procesando...</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  }

  @section Scripts {
    @*@Scripts.Render("~/bundles/jqueryval")
      @Scripts.Render("~/bundles/select2")
      @Scripts.Render("~/bundles/KOAmplify")*@
    @*<script src="@Url.Content("~/Scripts/ViewModelsKO/ComprobanteCreate.js")"></script>*@
    <script type="text/javascript">
    </script>
  }
